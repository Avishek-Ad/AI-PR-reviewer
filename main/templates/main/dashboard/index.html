{% extends "base.html" %}

{% block head_title %}Dashboard | AI Code Review{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-950 text-slate-200">
    {% include "main/dashboard/navbar.html" %}
    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-10">
            <div>
                <h1 class="text-3xl font-bold text-white">Your Repositories</h1>
                <p class="text-slate-400 mt-1">Connect a repository to enable automatic AI reviews on every PR.</p>
            </div>
            <a href='{% url "task-create" %}'
               class="btn btn-primary shadow-[0_0_20px_rgba(var(--color-primary),0.3)]">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
                Create a review task
            </a>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-3 gap-6 mb-10">
            <div class="stats bg-slate-900 border border-white/5 shadow-lg">
                <div class="stat">
                    <div class="stat-title text-slate-400">Total Reviews</div>
                    <div class="stat-value text-primary">{{total_reviews}}</div>
                    <div class="stat-desc text-slate-500">Across all repos</div>
                </div>
            </div>

            <div class="stats bg-slate-900 border border-white/5 shadow-lg">
                <div class="stat">
                    <div class="stat-title text-slate-400">Active Webhooks</div>
                    <div class="stat-value text-secondary">{{tasks.count}}</div>
                    <div class="stat-desc text-slate-500">Connected repositories</div>
                </div>
            </div>

            <div class="stats bg-slate-900 border border-white/5 shadow-lg col-span-2 md:col-span-1">
                <div class="stat">
                    <div class="stat-title text-slate-400">
                        Search Repository
                        <span id="task-search-loading" class="loading loading-spinner text-secondary loading-xs htmx-indicator"></span>
                    </div>
                    <div class="stat-value py-2">
                        <div class="flex items-center gap-3 bg-slate-800/50 rounded-lg px-3 py-1 border border-white/10 focus-within:border-secondary transition-colors">
                            <svg class="h-5 w-5 text-secondary opacity-70" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none" stroke="currentColor">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.3-4.3"></path>
                                </g>
                            </svg>
                            <input 
                                type="search" 
                                placeholder="Search..."
                                name="search"
                                class="bg-transparent border-none outline-none focus:ring-0 text-base font-normal w-full text-white placeholder:text-slate-500" 
                                hx-get='{% url "dashboard-page" %}'
                                hx-target="#task-repo-table-container"
                                hx-trigger="keyup changed delay:300ms"
                                hx-swap="innerHTML"
                                hx-indicator="#task-search-loading"
                            />
                        </div>
                    </div>
                    <div class="stat-desc text-slate-500">Filter by name</div>
                </div>
            </div>
        </div>

        <div class="card bg-slate-900 border border-white/10 overflow-hidden">
            <div id="task-repo-table-container" class="overflow-x-auto">
                {% include "main/partials/task-repo-table.html" %}
            </div>
        </div>
    </main>
</div>
{% endblock %}
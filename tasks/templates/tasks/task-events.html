{% extends "base.html" %}

{% block head_title %}Task Events | {{ repo_name }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-950 text-slate-200 pb-20">
    <div class="bg-slate-900/40 border-b border-white/10 backdrop-blur-md sticky top-0 z-30">
        <div class="max-w-6xl mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="{% url 'dashboard-page' %}" class="btn btn-ghost btn-sm text-slate-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"/></svg>
                    Back
                </a>
                <div>
                    <h1 class="text-xl font-bold text-white leading-none">{{ repo_name }}</h1>
                    <span class="text-xs font-mono text-primary uppercase tracking-widest">Active Task Pipeline</span>
                </div>
            </div>
            
            <a href="{{ repo_url }}" target="_blank" class="btn btn-sm btn-outline border-white/10 hover:bg-white/5 text-slate-300">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" class="mr-2"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
                View on GitHub
            </a>
        </div>
    </div>

    <main class="max-w-6xl mx-auto px-6 mt-10">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-12">
            <div class="lg:col-span-1 space-y-4">
                <div class="card bg-slate-900 border border-white/5 p-5 shadow-xl">
                    <h3 class="text-slate-500 text-xs font-bold uppercase mb-4 tracking-tighter">Repository Health</h3>
                    <div class="flex flex-col gap-4">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Total PRs</span>
                            <span class="badge badge-neutral">{{ events|length }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-3">
                <h2 class="text-lg font-semibold text-white mb-6 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-primary shadow-[0_0_8px_rgba(var(--color-primary),0.8)]"></span>
                    Recent Webhook Activity
                </h2>

                <div class="space-y-3">
                    {% for event in events %}
                    <div class="group relative bg-slate-900/50 border border-white/5 hover:border-primary/30 rounded-xl transition-all duration-300">
                        <div class="p-5 flex items-center justify-between">
                            <div class="flex items-start gap-4">
                                <div class="mt-1">
                                    <div class="w-8 h-8 rounded-full bg-success/10 flex items-center justify-center text-success">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M5 13l4 4L19 7"/></svg>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-xs font-mono text-slate-500">#{{ event.pr_number }}</span>
                                        <h3 class="text-white font-medium group-hover:text-primary transition-colors">{{ event.title }}</h3>
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-slate-400">
                                        <span class="flex items-center gap-1">
                                            <img src="{{ event.author_avatar_url }}" class="w-4 h-4 rounded-full border border-white/10" alt="">
                                            {{ event.author_name }}
                                        </span>
                                        <span>â€¢</span>
                                        <span>{{ event.received_at|timesince }} ago</span>
                                    </div>
                                </div>
                            </div>

                            <a href="{{ event.pr_url }}" target="_blank" class="btn btn-circle btn-ghost btn-sm opacity-0 group-hover:opacity-100 transition-opacity">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </a>
                        </div>
                        
                        <a href="{{ event.pr_url }}" target="_blank" class="absolute inset-0 z-0 cursor-pointer"></a>
                    </div>
                    {% empty %}
                    <div class="text-center py-20 border-2 border-dashed border-white/5 rounded-2xl">
                        <p class="text-slate-500 italic">Listening for incoming PR webhooks...</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>
</div>
{% endblock %}
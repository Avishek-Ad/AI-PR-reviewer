{% extends "base.html" %}

{% block head_title %}Link New Repository | AI Code Review{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-950 text-slate-200">
    <div class="max-w-4xl mx-auto px-6 pt-6">
        <div class="flex items-center gap-4 mb-8">
            <a href="{% url 'dashboard-page' %}" class="btn btn-circle btn-ghost btn-sm border border-white/10">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </a>
            <h1 class="text-3xl font-bold text-white tracking-tight">Create New Task</h1>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
            <div class="md:col-span-1 space-y-6">
                <div>
                    <h3 class="text-primary font-mono text-xs uppercase tracking-widest mb-2">Step 1</h3>
                    <p class="text-sm text-slate-400 leading-relaxed">Select the repository you want our AI to monitor. We only show repos where the GitHub App is installed.</p>
                </div>
                <div class="p-4 rounded-xl bg-blue-500/5 border border-blue-500/10">
                    <p class="text-xs text-blue-300">
                        <strong>Missing a repo?</strong><br>
                        Make sure you've granted access in your 
                        <a href="#" class="underline hover:text-white">GitHub App Settings</a>.
                    </p>
                </div>
            </div>

            <div class="md:col-span-2">
                <div class="card bg-slate-900 border border-white/10 shadow-2xl">
                    <form
                    class="card-body px-8 py-6"
                    hx-post='{% url "task-create" %}'
                    hx-target="#error-container"
                    hx-swap="innerHTML"
                    >
                    {% csrf_token %}
                        
                        <div class="form-control w-full mb-4">
                            <label class="label">
                                <span class="label-text text-slate-300 font-semibold py-1">
                                    Search Repositories
                                    <span id="repos-load-loading" class="loading loading-spinner text-success htmx-indicator"></span>
                                </span>
                            </label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                                </div>
                                <input
                                    type="text"
                                    placeholder="e.g. my-awesome-project"
                                    name="query"
                                    class="input input-bordered w-full pl-10 bg-slate-950 border-white/10 focus:border-primary transition-all" 
                                    hx-get='{% url "task-create" %}'
                                    hx-trigger="keyup changed delay:300ms"
                                    hx-target="#user-repos-list"
                                    hx-swap="innerHTML"
                                    hx-indicator="#repos-load-loading"
                                    />
                            </div>
                        </div>

                        <div id="user-repos-list" class="space-y-3 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                            {% include "tasks/partials/list-repos.html" %}
                        </div>

                        <div class="mt-6 space-y-3">
                            <div id='error-container'>
                            </div>
                            <button 
                            type="submit"
                            class="btn btn-primary w-full shadow-lg shadow-primary/20"
                            >
                                Start Monitoring
                            </button>
                            <p class="text-center text-[10px] text-slate-500 mt-4 uppercase tracking-widest font-bold">
                                Powered by GPT-4o Reviewer
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
</style>
{% endblock %}